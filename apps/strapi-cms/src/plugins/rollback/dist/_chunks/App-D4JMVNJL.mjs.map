{"version":3,"file":"App-D4JMVNJL.mjs","sources":["../../admin/src/pages/HomePage.tsx","../../admin/src/pages/App.tsx"],"sourcesContent":["import { Typography } from '@strapi/design-system';\nimport { Thead } from '@strapi/design-system';\nimport { Tr } from '@strapi/design-system';\nimport { Table } from '@strapi/design-system';\nimport { Main } from '@strapi/design-system';\nimport { useFetchClient, useNotification, useRBAC } from '@strapi/strapi/admin';\nimport pluginPermissions from '../permissions';\nimport { Th } from '@strapi/design-system';\nimport { Box } from '@strapi/design-system';\nimport { useEffect, useState } from 'react';\nimport { PLUGIN_ID } from '../pluginId';\nimport { Tbody } from '@strapi/design-system';\nimport { Td } from '@strapi/design-system';\nimport { Button } from '@strapi/design-system';\nimport { Flex } from '@strapi/design-system';\n\nconst HomePage = () => {\n  const { get, post } = useFetchClient();\n  const [loading, setLoading] = useState<boolean>(false);\n  const [triggering, setTriggering] = useState<boolean>(false);\n  const [deployments, setDeployments] = useState<string[]>([]);\n  const {\n    allowedActions: { canTrigger },\n  } = useRBAC(pluginPermissions.trigger);\n  const { toggleNotification } = useNotification();\n\n  async function fetchDeployments() {\n    setLoading(true);\n\n    try {\n      const res = await get<string[]>(`/${PLUGIN_ID}/deployments`);\n      setDeployments(res.data);\n    } catch (error: any) {\n      if (error.name === 'AbortError') {\n        // User likely just changed page before fetch completed, do nothing\n        return;\n      } else {\n        console.error(error);\n        toggleNotification({\n          type: 'danger',\n          title: 'Impossibile recuperare la lista di deploy passati!',\n        });\n      }\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function triggerRollback(deployment: string) {\n    setTriggering(true);\n\n    try {\n      const { data } = await post(`/${PLUGIN_ID}/trigger`, { deployment });\n      if (data.success) {\n        toggleNotification({\n          type: 'success',\n          title: 'Rollback lanciato con successo!',\n        });\n      } else {\n        throw new Error(`GITHUB WORKFLOW ERROR.\\n\\nStatus: ${data.status}\\nError: ${data.err}`);\n      }\n    } catch (error: any) {\n      if (error.name === 'AbortError') {\n        // User likely just changed page before fetch completed, do nothing\n        return;\n      } else {\n        console.error(error);\n        toggleNotification({\n          type: 'danger',\n          title: 'Impossibile lanciare il rollback!',\n        });\n      }\n    } finally {\n      setTriggering(false);\n    }\n  }\n\n  const formatDeployment = (deployment: string) => {\n    const date = deployment.split('_')[0].split('-').reverse().join('/');\n    const time = deployment.split('_')[1].replaceAll('-', ':');\n\n    return `${date} (${time})`;\n  }\n\n  useEffect(() => {\n    fetchDeployments();\n  }, [])\n\n  return (\n    <Main\n      style={{\n        padding: '3.2rem 5.4rem',\n      }}\n    >\n      <Box style={{ marginBottom: '3.2rem' }}>\n        <Typography variant=\"alpha\">Rollback di Produzione</Typography>\n      </Box>\n      \n      <Table colCount={5} rowCount={11}>\n        <Thead>\n          <Tr>\n            <Th key={'date'}>\n              <Typography variant=\"sigma\">\n                Deploy passati disponibili\n              </Typography>\n            </Th>\n            <Th key={'actions'}/>\n          </Tr>\n        </Thead>\n        <Tbody>\n          {loading ? (\n            <Tr>\n              <Td>\n                <Typography variant=\"sigma\">Recuperando i deploy passati...</Typography>\n              </Td>\n            </Tr>\n          ) : deployments.map((deployment, index) => (\n            <Tr key={deployment}>\n              <Td>\n                <Typography variant=\"sigma\">{formatDeployment(deployment)}{index === 0 && ' (Attualmente in prod)'}</Typography>\n              </Td>\n              <Td>\n                <Flex justifyContent='flex-end'>\n                  <Button disabled={!canTrigger || triggering || index === 0} onClick={() => {triggerRollback(deployment)}}>\n                    ROLLBACK A QUESTO DEPLOY\n                  </Button>\n                </Flex>\n              </Td>\n            </Tr>\n          ))}\n        </Tbody>\n      </Table>\n    </Main>\n  );\n};\n\nexport { HomePage };\n","import { Page } from '@strapi/strapi/admin';\nimport { Routes, Route } from 'react-router-dom';\nimport { HomePage } from './HomePage';\nimport pluginPermissions from '../permissions';\n\nconst App = () => {\n  return (\n    <Page.Protect permissions={pluginPermissions.access}>\n      <Routes>\n        <Route index element={<HomePage />} />\n        <Route path=\"*\" element={<Page.Error />} />\n      </Routes>\n    </Page.Protect>\n  );\n};\n\nexport { App };\n"],"names":[],"mappings":"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"}
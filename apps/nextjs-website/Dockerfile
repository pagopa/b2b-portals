FROM node:18-alpine
RUN apk add --no-cache g++ make py3-pip libc6-compat
ARG ENVIRONMENT
ENV ENVIRONMENT=${ENVIRONMENT}
ARG PREVIEW_MODE
ENV PREVIEW_MODE=${PREVIEW_MODE}
ARG STRAPI_API_TOKEN
ENV STRAPI_API_TOKEN=${STRAPI_API_TOKEN}
ARG PREVIEW_TOKEN
ENV PREVIEW_TOKEN=${PREVIEW_TOKEN}
ARG STRAPI_API_BASE_URL
ENV STRAPI_API_BASE_URL=${STRAPI_API_BASE_URL}
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build
EXPOSE 3000
CMD npm run start